i trung tâm; đông thời đó cũng là những nền tảng vững chắc cho em để có thể ứng dụng vào những công việc mới trong tương lai. TP. Hồ Chí Minh, 5/2009 Phùng Chí Tuệ TÓM TẮT Mục đích đồ án:  Tìm hiểu các điểm yếu dễ bị tấn công trong hệ thống email hiện nay.  Các giải pháp bảo mật cho hệ thống email.  Tìm hiểu về các cơ chế phòng chống spam mail.  Triển khai hệ thống bảo mật email bằng PGP. Cấu trúc đồ án:  Chương 1: Giới thiệu tổng quan về SMTP, POP3, IMAP.  Chương 2: Các nguy cơ bị tấn công khi sử dụng hệ thống email.  Chương 3: Các cơ chế phòng chống spam mail.  Chương 4: Các giải pháp bảo mật hệ thống email. MỤC LỤC Chương 1: GIỚI THIỆU TỔNG QUAN VỀ SMTP, POP3, IMAP 1.1 Kiến trúc và hoạt động của thư điện tử 1.2 Giới thiệu về giao thức SMTP 1.3 Giới thiệu về giao thức POP và IMAP Chương 2: CÁC NGUY CƠ BỊ TẤN CÔNG KHI SỬ DỤNG HỆ THỐNG EMAIL 2.1 Sự thiếu bảo mật trong hệ thống email 2.2 Các nguy cơ trong quá trình gửi email Chương 3: CÁC CƠ CHẾ PHÒNG CHỐNG SPAM MAIL 3.1 Giới thiệu về spam 3.1.1 Spam là gì? 3.1.2 Các loại spam 3.1.3 Tác hại của spam 3.2 Cơ chế hoạt động của spam 3.2.1 Thu thập địa chỉ email 3.2.2 Gửi spam 3.3 Các biện pháp phòng chống spam 3.3.1 DNS Blacklist 3.3.2 SURBL List 3.3.3 Chặn IP 3.3.4 Kiểm tra địa chỉ IP 3.3.5 Sử dụng bộ lọc Bayesian 3.3.6 Sử dụng danh sách Black/White list 3.3.7 Sử dụng Challenge/Response 3.3.8 Kiểm tra header Chương 4: CÁC GIẢI PHÁP BẢO MẬT HỆ THỐNG EMAIL 4.1 Các cơ chế mã hóa email 4.1.1 Mã hóa và xác thực bằng PGP 4.1.2 Mã hóa và xác thực bằng MIME 4.2 Ứng dụng PGP 4.2.1 Cài đặt 4.2.2 Sử dụng khóa 4.2.3 Mã hóa và giải mã 4.2.4 Quy trình ký nhận và kiểm tra chữ ký CHƯƠNG I GIỚI THIỆU TỔNG QUAN VỀ SMTP, POP3, IMAP 1.1 Kiến trúc và hoạt động của thư điện tử Muốn gửi thư điện tử người gửi cần phải có một account trên một máy chủ thư. Một máy chủ có thể có một hoặc nhiều account. Mỗi account đều được mang một tên khác nhau (user). Mỗi account đều có một hộp thư riêng (mailbox) cho account đó. Thông thường thì tên của hộp thư sẽ giống như tên của account. Ngoài ra máy vi tính đó phải được nối trực tiếp hoặc gián tiếp với hệ thống Internet nếu muốn gửi nhận thư điện tử toàn cầu. Người sử dụng máy vi tính tại nhà vẫn có thể gửi nhận thư điện tử bằng cách kết nối máy vi tính của họ với một máy vi tính khác bằng modem. Có một số nơi cấp phát account thư điện tử miễn phí cho các máy vi tính tại nhà có thể dùng modem để kết nối với máy vi tính đó để chuyển nhận thư điện tử như hotmail.com hoặc yahoo.com .v.v. Ngoài ra, còn có rất nhiều cơ quan thương mại cung cấp dịch vụ hoặc account cho máy vi tính tại nhà nhưng người sử dụng phải trả tiền dịch vụ hàng tháng. Đường đi của thư Thư điện tử chuyển từ máy máy chủ thư điện tử này (mail server) tới máy chủ tư điện tử khác trên internet. Khi thư được chuyển đến đích thì nó được chứa tại hộp thư điện tử tại máy chủ thư điện tử cho đến khi nó được nhận bởi người nhận. Toàn bộ quá trình xử lý chỉ xẩy ra trong vài phút, do đó nó cho phép nhanh chóng liên lạc với mọi người trên toàn thế giới một cánh nhanh chóng tại bất cứ thời điểm nào dù ngày hay đêm. Gửi, nhận và chuyển thư Để nhận được thư điện tử bạn cần phải có một tài khoản (account) thư điện tử. Nghĩa là bạn phải có một địa chỉ để nhận thư. Một trong những thuận lợi hơn với thư thông thường là bạn có thể nhận thư điện tử từ bất cứ đâu. Bạn chỉ cần kết nối vào Server thư điện tử để lấy thư về máy tính của mình. Để gửi được thư bạn cần phải có một kết nối vào internet và truy nhập vào máy chủ thư điện tử để chuyển thư đi. Thủ tục tiêu chuẩn được sử dụng để gửi thư là SMTP (Simple Mail Transfer Protocol). Nó được kết hợp với thủ tục POP (Post Office Protocol) và IMAP để lấy thư. Mô hình của hệ thống máy chủ thư điện tử: Bảo mật email và cách phòng chống spam Với một hệ thống máy chủ thư điện tử cung cấp cho một đơn vị vừa và nhỏ thì toàn bộ hệ thống thường được tích hợp vào một máy chủ. Và máy chủ đó vừa làm chức năng nhận, gửi thư, lưu trữ hộp thư và kiểm soát thư vào ra. - Sử dụng thủ tục SMTP để chuyển, nhận thư giữa các máy chủ thư với nhau. - Sử dụng thủ tục SMTP để cho phép mail client gửi thư lên máy chủ. - Sử dụng thủ tục POP hoặc IMAP đển mail client nhận thư về. 1.2 Giới thiệu về giao thức SMTP Giới thiệu Mục tiêu của SMTP là để chuyển truyền email tin cậy và hiệu quả. SMTP không phụ thuộc hệ thống con và chỉ yêu cầu 1 kênh truyền dữ liệu đáng tin cậy. Một tính năng quan trọng của SMTP của nó là khả năng relay(chuyển tiếp) mail qua môi trường dịch vụ truyền thông. Một dịch vụ truyền thông cung cấp một môi trường truyền thông giữa các tiến trình (IPCE). Một IPCE có thể bao gồm một mạng, một số mạng, hay một hệ thống mạng con. Có thể hiểu IPCE là môi trường cho phép một tiến trình có thể giao tiếp qua lại trực tiếp với một tiến trình khác. Điều quan trọng là các IPCE không chỉ có quan hệ 1-1 trên các mạng. Một tiến trình có thể giao tiếp trực tiếp với nhiều tiến trình khác thông qua IPCE. Mail là một ứng dụng của truyền thông liên tiến trình. Mail có thể được truyền tải giữa các tiến trình trên nhiều IPCEs khác nhau 1 tiến trình được kết nối giữa hai (hay nhiều) IPCE. Cụ thể hơn, email có thể được chuyển tiếp (relay) qua nhiều Host trên các hệ thống chuyển tải khác nhau qua các Host trung gian. Mô hình SMTP Các SMTP được thiết kế dựa trên các mô hình truyền thông sau: - Khi có các yêu cầu mail từ người sử dụng, phía SMTP-send sẽ thiết lập một kênh truyền hai chiều tới phía SMTP-receiver - SMTP-receiver ở đây có thể là đích đến cuối cùng hay chỉ là một địa chỉ trung gian. - SMTP-send gửi SMTP commands đến SMTP-receiver. - SMTP-receiver đáp ứng SMTP commands bằng cách gửi trả cho SMTP- send các SMPT replies tương ứng Một khi kênh truyền đã được thiết lập, SMTP-sender sẽ gửi một MAIL command cho biết người gửi. Nếu SMTP-receiver chấp nhận mail nó sẽ đáp ứng 1 OK reply. Sau đó SMTP-sender lại gửi một RCPT command cho biết là người sẽ nhận mail, nếu SMTP-receiver chấp nhận mail này cho người nhận đó thì nó reply lại là OK, nếu không nó sẽ reply lại là mail này bị loại bỏ. Nếu SMTP-receiver reply là OK thì SMTP-sender sẽ gửi dữ liệu mail tới phía nhận và kết thúc bằng một command đặc biệt nào đó. Nếu SMTP-receiver xử lý thành công dữ liệu mail này thì nó sẽ reply lại là OK. Bảo mật email và cách phòng chống spam - SMTP cung cấp nhiều kĩ thuật cách khác nhau để gửi mail: o Truyền thẳng khi host phía gửi và host phía nhận được kết nối tới cùng một dịch vụ truyền tải. o Thông qua các máy chủ SMTP khi host phía gửi và host phía nhận không được kết nối tới cùng một dịch vụ truyền tải Đối số cho mail command là 1 tuyến ngược (reverse-path), trong đó ghi rõ mail được gửi từ ai. Đối số cho RCPT command là một tuyến chuyển tiếp (forward-path), chỉ ra mail được gửi cho ai. Tuyến chuyển tiếp là 1tuyến nguồn, trong khi các tuyến ngược là 1 tuyến quay trở (có thể được dùng để trả lại một thông báo cho người gửi khi một lỗi xảy ra với một message chuyển tiếp). Khi cùng một message được gửi đến nhiều người nhận, SMTP khuyến khích việc truyền tải chỉ có một bản sao của các dữ liệu cho tất cả các người nhận tại cùng một máy chủ đích. Các mail command và reply có một cú pháp cứng nhắc. Các reply cũng có 1 mã số. Trong phần sau đây, mà xuất hiện các ví dụ thực tế sử dụng các mail command và reply, các danh sách đầy đủ các command và reply. Các command và reply không phải là trường hợp nhạy cảm. Tức là, một từ command hoặc reply có thể là chữ thường, hoa, hay hỗn hợp. Lưu ý rằng điều này là không đúng với tên người sử dụng hộp thư. Vì đối với một số máy tên người sử dụng là trường hợp nhạy cảm, và các triển khai SMTP phải đưa trường hợp này ra để bảo vệ các trường hợp tên người dùng giống với các tham số trong mailbox. Tên máy chủ không phải là trường hợp nhạy cảm. Các command và reply là gồm các kí tự ASCII. Khi dịch vụ chuyển thư cung cấp 1 kênh truyền 1 byte 8bit (octet), mỗi kí tự 7 bit được đưa vào các bit thấp của octet, bit cao của octet xóa về 0. Bảo mật email và cách phòng chống spam Khi cụ thể hóa các dạng chung của mỗi lệnh và reply, 1 đối số sẽ được biểu diễn bằng 1 biến(hay 1 hằng) trong ngôn ngữ meta , chẳng hạn, “” hoặc “” Khi xác định các hình thức chung của một lệnh hoặc trả lời, một đối số. Ở đây các dấu ‘<’ cho biết đây là biến trong ngôn ngữ meta. MIME và SMTP MIME (Multipurpose Internet Mail Extensions) cung cấp thêm khả năng cho SMTP và cho phép các file có dạng mã hoá multimedia đi kèm với bức điện SMTP chuẩn. MIME sử dụng bảng mã Base64 để chuyển các file dạng phức tạp sang mã ASCII để chuyển đi. MIME là một tiêu chuẩn mới như nó hiện đã được hỗ trợ bởi hầu hết các ứng dụng, và bạn phải thay đổi nếu chương trình thư điện tử của bạn không có hỗ trợ MIME. MIME được quy chuẩn trong các tiêu chuẩn RFC 2045-2049. S/MIME Là một chuẩn mới của MIME cho phép hỗ trợ cho các bức điện được mã hoá. S/MIME dựa trên kỹ thuật mã công cộng RSA và giúp cho bức điện không bị xem trộm hoặc chặn lấy.hoá Lệnh của SMTP Một cách đơn giản SMTP sử dụng các câu lệnh ngắn để điều khiển bức điện. Bảng ở dưới là danh sách các lệnh của SMTP Các lệnh của SMTP được xác định trong tiêu chuẩn RFC 821. HELO Hello. Sử dụng để xác định người gửi điện. Lệnh này này đi kèm với tên của host gửi điện. Trong ESTMP (extended protocol), thì lệnh này sẽ là EHLO. MAIL Khởi tạo một giao dịch gửi thư. Nó kết hợp "from" để xác định người gửi thư. RCPT Xác định người nhận thư. DATA Thông báo bất đầu nội dung thực sự của bức điện (phần thân của thư). Dữ liệu được mã thành dạng mã 128-bit ASCII và nó được kết thúc với một dòng đơn chứa dấu chấm (.). RSET Huỷ bỏ giao dịch thư VRFY Sử dụng để xác thực người nhận thư. NOOP Nó là lệnh "no operation" xác định không thực hiện hành động gì QUIT Thoát khỏi tiến trình để kết thúc SEND Cho host nhận biết rằng thư còn phải gửi đến đầu cuối khác. Bảo mật email và cách phòng chống spam SMTP mở rộng (Extended SMTP) SMTP thì được cải thiệt để ngày càng đáp ứng nhu cầu cao của người dùng và là một thủ tục ngày càng có ích. Như dù sao cũng cần có sự mở rộng tiêu chuẩn SMTP và chuẩn RFC 1869 ra đời để bổ xung cho SMTP. Nó không chỉ mở rộng mà còn cung cấp thêm các tính năng cần thiết cho các lệnh có sẵn. Ví dụ: lệnh SIZE là lệnh mở rộng cho phép nhận giới hạn độ lớn của bức điện đến. Không có ESMTP thì sẽ không giới hạn được độ lớn của bức thư. Khi hệ thống kết nối với một MTA, nó sẽ sử dụng khởi tạo thì ESMTP thay HELO bằng EHLO. Nếu MTA có hỗ trợ SMTP mở rộng (ESMTP) thì nó sẽ trả lời với một danh sách các lệnh mà nó sẽ hỗ trợ. Nếu không nó sẽ trả lời với mã lệnh sai (500 Command not recognized) và host gửi sẽ quay trở về sử dụng SMTP. Sau đây là một tiến trình ESMTP: 220 esmtpdomain.com Server ESMTP Sendmail 8.8.8+Sun/8.8.8; Thu, 22 Jul 1999 09:43:01 EHLO host.sendingdomain.com 250-mail.esmtpdomain.com Hello host, pleased to meet you 250-EXPN 250-VERB 250-8BITMIME 250-SIZE 250-DSN 250-ONEX 250-ETRN 250-XUSR 250 HELP QUIT 221 Goodbye host.sendingdomain.com SMTP Headers Có thể lấy được rất nhiều thông tin có ích bằng cách kiểm tra phần header của thư. Không chỉ xem được bức điện từ đâu đến, chủ đề của thư, ngày gửi và những người nhận. Bạn còn có thể xem được những điểm mà bức điện đã đi qua trước khi đến được hộp thư của bạn. Tiêu chuẩn RFC 822 quy định header chứa những gì. Tối thiểu có người gửi (from), ngày gửi và người nhận (TO, CC, hoặc BCC) Header của thư khi nhận được cho phép bạn xem bức điện đã đi qua những đâu trước khi đến hộp thư của bạn. Nó là một dụng cụ rất tốt để kiểm tra và giải quyết lỗi. Sau đây là ví dụ: From someone@mydomain.COM Sat Jul 31 11:33:00 1999 Received: from host1.mydomain.com by host2.mydomain.com (8.8.8+Sun/8.8.8) with ESMTP id LAA21968 for ; Sat, 31 Jul 1999 11:33:00 -0400 (EDT) Bảo mật email và cách phòng chống spam Received: by host1.mydomain.com with Interne Mail Service (5.0.1460.8) id ; Sat, 31 Jul 1999 11:34:39 -0400 Message-ID: From: "Your Friend" To: "'jamisonn@host2.mydomain.com'" Subject: Hello There Date: Sat, 31 Jul 1999 11:34:36 -0400 Trên ví dụ trên có thể thấy bức điện được gửi đi từ someone@mydomain.com. Từ mydomain.com, nó được chuyển đến host1. Bức điện được gửi từ host2 tới host1 và chuyển tới người dùng. Mỗi chỗ bức điện dừng lại thì host nhận được yêu cầu điền thêm thông tin vào header nó bao gồm ngày giờ tạm dừng ở đó. Host2 thông báo rằng nó nhận được điện lúc 11:33:00. Host1 thông báo rằng nó nhận được bức điện vào lúc 11:34:36, Sự trên lệch hơn một phút có khả năng là do sự không đồng bộ giữa đồng hồ của hai nơi. Thuận lợi và bất lợi của SMTP Như thủ tục X.400, SMTP có một số thuận lợi và bất lợi Thuận lợi bao gồm:  SMTP rất phổ biến.  Nó được hỗ trợ bởi nhiều tổ chức.  SMTP có giá thành quản trị và duy trì thấp.  SMTP nó có cấu trúc địa chỉ đơn giản. Bất lợi bao gồm:  SMTP thiếu một số chức năng  SMTP thiết khả năng bảo mật như X.400. Nó chỉ giới hạn vào những tính năng đơn giản nhất 1.3 Giới thiệu về giao thức POP và IMAP Trong nhưng ngày tháng đầu tiên của thư điện tử, người dùng được yêu cầu truy nhập vào máy chủ thư điện tử và đọc các bức điện của họ ở đó. Các chương trình thư thường sử dụng dạng text và thiếu khả năng thân thiện với người dùng. Để giải quyết vấn đề đó một số thủ tục được phát triển để cho phép người dùng có thể lấy thư về máy của họ hoặc có các giao diện sử dụng thân thiện hơn với người dùng. Và chính điều đó đem đến sử phổ biến của thư điện tử. Có hai thủ tục được sử dụng phổ biến nhất hiện này là POP (Post Office Protocol) và IMAP (Internet Mail Access Protocol). Post Office Protocol (POP) POP cho phép người dùng có account tại máy chủ thư điện tử kết nối vào MTA và lấy thư về máy tính của mình, ở đó có thể đọc và trả lời lại. POP được phát triển đầu tiên là vào năm 1984 và được nơng cấp từ bản POP2 lên POP3 vào năm 1988. Và hiện nay hầu hết người dùng sử dụng tiêu chuẩn POP3 Bảo mật email và cách phòng chống spam POP3 kết nối trên nền TCP/IP để đến máy chủ thư điển tử (sử dụng cổng 110). Người dùng điền username và password. Sau khi xác thực đầu client sẽ sử dụng các lệnh của POP3 để lấy hoặc xoá thư. POP3 chỉ là thủ tục để lấy thư trên máy chủ thư điện tử. POP3 được quy định bởi tiêu chuẩn RFC 1939. Lệnh của POP3 Lệnh Miêu tả USER Xác định username PASS Xác định password STAT Yêu cầu về trạng thái của hộp thư như số lượng thư và độ lớn của thư LIST Hiện danh sách của thư RETR Nhận thư DELE Xoá một bức thư xác định NOOP Không làm gì cả RSET Khôi phục lại như thư đã xoá (rollback) QUIT Thực hiện việc thay đổi và thoát ra Internet Mail Access Protocol (IMAP) Thủ tục POP3 là một thủ tục rất có ích và sử dụng rất đơn giản để lấy thư về cho người dùng. Như sự đơn giản đó cũng đem đến việc thiếu một số công dụng cần thiết. Ví dụ: POP3 chỉ là việc với chế độ offline có nghĩa là thư được lấy về sẽ bị xoá trên server. IMAP thì hỗ trợ những thiếu sót của POP3. IMAP được phát triển vào năm 1986 bởi trường đại học Stanford. IMAP2 phát triển vào năm 1987. IMAP4, là bản mới nhất đang được sử dụng và nó được các tổ chức tiêu chuẩn Internet chấp nhận vào năm 1994. IMAP4 được quy định bởi tiêu chuẩn RFC 2060 và nó sử dụng cổng 143 của TCP. Lệnh của IMAP4 Lệnh Miêu tả CAPABILITY Yêu cầu danh sách các chức năng hỗ trợ AUTHENTICATE Xác định sử dụng xác thực từ một server khác LOGIN Cung cấp username và password SELECT Chọn hộp thư EXAMINE Điền hộp thư chỉ được phép đọc CREATE Tạo hộp thư DELETE Xoá hộp thư Bảo mật email và cách phòng chống spam Lệnh Miêu tả RENAME Đổi tên hộp thư SUBSCRIBE Thêm vào một list đang hoạt động UNSUBSCRIBE Dời khỏi list đang hoạt động LIST Danh sách hộp thư LSUB Hiện danh sách người sử dụng hộp thư STATUS Trạng thái của hộ thư (số lượng thư,...) APPEND Thêm message vào hộp thư CHECK Yêu cầu kiểm tra hộp thư CLOSE Thực hiện xoá và thoát khỏi hộp thư EXPUNGE Thực hiện xoá SEARCH Tìm kiếm trong hộp thư để tìm messages xác định FETCH Tìm kiếm trong nội dung của message STORE Thay đổi nội dụng của messages COPY Copy message sang hộp thư khác NOOP Không làm gì LOGOUT Đóng kết nối  So sánh POP3 và IMAP4 Có rất nhiều điểm khác nhau giữa POP3 và IMAP4. Phụ thuộc vào người dùng, MTA, và sự cần thiết , Có thể sử dụng POP3, IMAP4 hoặc cả hai. Lợi ích của POP3 là :  Rất đơn giản.  Được hỗ trợ rất rộng Bởi rất đơn giản nên, POP3 có rất nhiều giới hạn. Ví dụ nó chỉ hỗ trợ sử dụng một hộp thư và thư sẽ được xoá khỏi máy chủ thư điện tử khi lấy về. IMAP4 có nhưng lợi ích khác:  Hỗ trợ xác thực rất mạnh  Hỗ trợ sử dụng nhiều hộp thư  Đặc biệt hỗ trợ cho các chế việc làm việc online, offline, hoặc không kết nối IMAP4 ở chế độ online thì hỗ trợ cho việc lấy tập hợp các thư từ máy chủ, tìm kiếm và lấy message cần tìm về ...IMAP4 cũng cho phép người dùng chuyển thư từ thư mục này của máy chủ sang thư mục khác hoặc xoá thư. IMAP4 hỗ trợ rất tốt cho người dùng hay phải di chuyển và phải sử dụng các máy tính khác nhau. Bảo mật email và cách phòng chống spam CHƯƠNG II CÁC NGUY CƠ BỊ TẤN CÔNG KHI SỬ DỤNG EMAIL 2.1 Sự thiếu bảo mật trong hệ thống email Webmail: nếu kết nối tới Webmail Server là “không an toàn” (ví dụ địa chỉ là http:// và không phải là https://), lúc đó mọi thông tin bao gồm Username và pasword không được mã hóa khi nó từ Webmail Server tới máy tính. SMTP: SMTP không mã hóa thông điệp. Mọi kết nối giữa SMTP servers gửi thông điệp của bạn dưới dạng chữ cho mọi kẻ nghe trộm thấy. Thêm vào đó, nếu email server yêu cầu bạn gửi username và password để “login” vào SMTP server mục đích để chuyển thông điệp tới một server khác, khi đó tất cả đều được gửi dưới dạng chữ, mục tiêu để nghe trộm. Cuối cùng, thông điệp gửi bằng SMTP bao gồm thông tin về máy tính mà chúng được gửi đi, và chương trình email đã được sử dụng. Những thông tin này sẵn sàng cho mọi người nhận, có thể mang tính chất cá nhân. POP và IMAP: Giao thức POP và IMAP yêu cầu bạn gửi username và password để login, đều không được mã hóa. Vì vậy, thông điệp của bạn có thể được đọc bởi bất kỳ kẻ nào đang nghe lén thông tin của máy tính cũng như nhà cung cấp dịch vụ email của bạn. Backups: thông điệp được lưu trữ trên SMTP server dưới dạng chữ, không được mã hóa.Việc Sao lưu dữ liệu trên server có thể được thực hiện bất cứ lúc nào và người quản trị có thể đọc bất kỳ dữ liệu nào trên máy tính. 2.1 Các nguy cơ trong quá trình gửi email Eavesdropping: Internet là nơi rộng lớn với rất nhiều người. Thật dễ dàng để ai đó truy cập vào máy tính hoặc đoạn mạng mà thông tin của bạn đang được truyền trên đó, để bắt thông tin và đọc. Giống như ai đó đang ở phòng kế bên đang lắng nghe cuộc nói chuyện điện thoại của bạn, hacker có thể sử dụng các công cụ man-in-the-middle để bắt toàn bộ các gói tin từ người sử dụng email. Việc này có thể được thực hiện một cách dễ dàng thông qua các chương trình như Cain&Abel, Ettercap...  Khắc phục Eavesdropping: - Do đó để tránh tình trạng eavesdropping xảy ra, chúng ta nên mã hóa các thông tin khi chúng được chuyển đi trên mạng internet để đến server Mail. Và ngay trên server, thông tin cũng cần phải được mã hóa để lưu trữ 1 cách an toàn sử dụng khóa bảo mật mà chỉ có người nhận đích thực mới biết. Bảo mật email và cách phòng chống spam Identify Theft: Nếu ai đó có thể thu thập username và password mà bạn dùng để truy cập vào email server, họ có thể đọc mail của bạn và gửi mail như bạn. Thông thường, những thông tin này có thể thu thập bởi kẻ nghe lén trên SMTP, POP, IMAP hoặc kết nối WebMail, bằng cách đọc thông điệp mà bạn đính kèm theo các thông tin này.  Khắc phục Identify Theft: - Để có thể khắc phục identity theft, chúng ta cần phải tạo ra được 1 sự trao đổi riêng tư, bí mật và an toàn bằng cách gửi những thông tin cá nhân và nội dung tin nhắn dưới dạng mã hóa khi chúng di chuyển trên internet. VD: MyMail đã sử dụng các đường link giao tiếp Secure Socket Protocol để giảm tình trạng indentify Theft xảy ra. Invasion of Privacy: Nếu bạn rất quan tâm đến thông tin riêng tư của mình, bạn cần xem xét khả năng “việc sao lưu của bạn không được bảo vệ . Bạn có thể cũng quan tâm đến việc những người khác có khả năng biết được địa chỉ IP của máy tính bạn. Thông tin này có thể được dùng để nhận ra thành phố bạn đang sống hoặc thậm chí trong trường hợp nào đó có thể tìm ra địa chỉ của bạn. Việc này không xảy ra với WebMail, POP, IMAP, nhưng đối với SMTP thì lại có khả năng xảy ra.  Khắc phục invasion of Privacy: - Tất cả các thông tin sẽ được bảo mật bằng cách mã hóa bằng khóa bí mật rồi lưu trữ, để có thể đọc được mail, người nhận cần phải đánh chính xác username và password của mình. - Dấu địa chỉ IP trong phần header message, điều này sẽ giúp bảo vệ những thông tin cá nhân như địa chỉ thành phố, tiểu bang mà bạn đang sống. - Mã hóa tất cả nội dung email để lưu trữ và cũng mã hóa khi cần truyền. Message Modification: Bất cứ người nào có quyền admin trên bất kỳ server SMTP nào mà thông điệp của bạn đến, thì không chỉ có thể đọc thông điệp của bạn, mà họ còn có thể xóa hay thay đổi thông điệp trước khi nó tiếp tục đi đến đích. Người nhận của bạn sẽ không thể biết thông điệp của bạn có bị thay đổi hay không? Nếu thông điệp bị xóa đi mất thì họ cũng không thể biết rằng có thông điệp đã được gửi cho họ.  Khắc phục Message Modification: - Khi email được gửi đến server mail thì nó cần lưu trữ dưới dạng mã hóa bằng 1 khóa bảo mật riêng, khi đó dù cho ai có quyền admin trên server, họ vẫn không thể thay đổi được nội dung email. - Thêm nữa chúng ta cũng phải ngăn chặn không cho System administrator có quyền truy suất tài khỏan email bằng cách đơn giản reset và tạo ra 1 password mới. Bảo mật email và cách phòng chống spam False Messages: Thật dễ dàng để tạo ra một thông điệp giả mạo mà có vẻ như được gửi bởi một người nào đó. Nhiều vius đã lợi dụng điểm này để lan truyền sang các máy tính khác. Nhìn chung, không có cách gì chắn chắn rằng người gửi thông điệp là người gửi thực sự - tên người gửi có thể dễ dàng làm giả.  Khắc phục False Messages: - Chúng ta có thể sử dụng Reverse DNS lookup, finger, và sự tăng cường sự kiểm tra credential (account,password) để nhận dạng địa chỉ email có chính xác không, đồng thời cũng xem xét được email có được gửi từ server Email và host hợp lệ hay không. Message Relay: Thông điệp có thể bị chặn lại, chỉnh sửa va gửi lại sau. Bạn có thể nhận được một tin nhắn nguyên gốc hợp lệ nhưng sau đó lại nhận được những tin nhắn giả mạo mà có vẻ như hợp lệ.  Khắc phục Message Relay: - Do tất cả nội dung của email được mã hóa bằng các khóa bảo mật động tương ứng do đó sẽ không có bất kì ai có thể thay đổi nội dung của email vì không có khóa bảo mật. Unprotected Backups: Thông điệp được lưu dưới dạng plain-text trên tất cả các server SMTP. Vì thế các bản sao lưu của các server sẽ chứa bản copy thông điệp của bạn. Bản sao lưu có thể giữ trong nhiều năm và có thể đọc bởi bất kỳ người nào có quyền truy cập. Thông điệp của bạn có thể được đặt ở những nơi không an toàn,và bất kì ai cũng có thể lấy nó được, thậm chí sau khi bạn nghĩ là đã xóa hết các bản copy của nó.  Khắc phục Unprotected Backups: - Như đã nói ở trên, nếu như nội dung và các thông tin của email đã được lưu dưới dạng mã hóa thì dù cho nó có được lưu lại một cách không mong đợi thì cũng không ai có thể đọc được nó. Repudiation: Bởi vì những thông điệp thông thường có thể bị giả mạo, do đó không có cách nào chứng minh rằng người khác có gửi cái thông điệp đó cho bạn hay không. Nghĩa là thậm chí nếu một ai đó đã gửi cho bạn một thông điệp, họ hoàn tòan có thể chối bỏ. Đây là 1 trong số những điểm hết sức cần lưu ý khi sử dụng email để thực hiện các hợp đồng, giao dịch kinh doanh…  Khắc phục Repudiation: Chúng ta cần mã hóa và lưu trữ bảo mật các thông tin cũng như nội dung của email bằng 1 khóa bảo mật duy nhất tương ứng với từng user khác nhau. Khi đó không ai có thể giảo mạo hoặc thay đổi nội dung của email. Điều này giúp ta đảm bảo được sự chính xác của email, nhờ đó các hoạt động kinh doanh, giao dịch sẽ diễn ra thuận lợi hơn, và cũng không ai có thể từ chối email mà chính mình đã gửi. Bảo mật email và cách phòng chống spam CHƯƠNG III CÁC BIỆN PHÁP PHÒNG CHỐNG SPAM MAIL 3.1 Giới thiệu về spam 3.1.1 Spam là gì? Spam hay còn gọi là UBE (Unsolicited Bulk Email) . Spam là những email không được sự cho phép của người nhận (unsolicited email) được gừi đi với số lượng lớn tới hồm thư của người dùng internet. Spam đôi khi cũng là những email thương mại không được sự cho phép của người nhận(UCE-Unsolicited Commercial E-Mail). Vậy Spam làm tràn môi trường Internet bằng cách gửi đi nhiều gói tin với cùng một nội dung, những gói tin này được truyền đến những người mà họ không thể không nhận chúng. 3.1.2 Các loại spam Có hai loại spam chính, chúng có những ảnh hưởng khác nhau đến người dùng Internet: Usernet spam: đây là dạng spam ta thường gặp trên các forum, một gói tin sẽ được gửi đến trên 20 newsgroup. Qua quá trình sử dụng, người dùng đã thấy rằng bất kỳ một tin nào được gửi đến nhiều newgroup một lúc thường sẽ mang những thông tin không cần thiết. Usernet spam cố gắng trở thành một “kẻ giấu mặt” – đọc thông tin trong các newsgroup nhưng ít khi hoặc không bao giờ post bài hay cho địa chỉ của mình. Usernet spam chiếm quyền sử dụng của các newsgroup bằng cách làm tràn ngập các quảng cáo hoặc những bài viết không phù hợp. Ngoài ra, Usernet spam có khi còn làm ảnh hưởng đến quyền điều khiển của quản trị hệ thống, chiếm quyền quản lý một topic nào đó. Email spam: Email spam nhắm đến người dùng riêng biệt trực tiếp qua các thư điện tử. Các spammer sẽ tiến hành thu thập địa chỉ mail bằng cách duyệt qua hòm thư Usenet, ăn cắp danh sách mail hay tìm kiếm trên web. Đối với những user sử dụng dịch vụ điện thoại thì đồng hồ đo vẫn chạy trong khi họ nhận hay đọc mail, chính vì vậy mà spam làm họ tốn thêm một khoản tiền. Trên hết,các ISP và các dịch vụ trực tuyến ( online services) phải tốn tiền để chuyển các email – spam đi, những chi phí này sẽ được chuyển trực tiếp đến các thuê bao. Bất cứ ai cũng có thể trở thành người gửi thư rác (spammer) Chẳng hạn, bạn có một món hàng độc đáo cần bán ngay. Nhưng làm sao để mọi người biết . Trước hết bạn thông báo cho bạn bè bằng cách gửi email cho 100 người nằm trong sổ địa chỉ của bạn. Như thế bạn không mất một đồng nào mà vẫn có thể gửi đi 100 email quảng cáo sản phẩm của mình. Nếu có người biết để mua hàng thì bạn sẽ lời to. Và bạn tự nhủ : "Tại sao mình không gửi email cho nhiều người khác nữa? Mình sẽ có thể thu được nhiều lợi nhuận hơn?” Rồi bạn sẽ tìm tòi ứng dụng các giải pháp để gửi đi được nhiều email cho cả những người bạn không quen biết hơn. Vậy là bạn đã trở thành spammer. Bảo mật email và cách phòng chống spam 3.1.3 Tác hại của spam Hầu hết các spam đều nhằm mục đích quảng cáo, thường cho những sản phẩm không đáng tin cậy hoặc những dịch vụ có vẻ như hợp pháp. Tuy nhiên, không phải mọi vụ gửi SPAM đều là nhằm mục đích quảng cáo thương mại. Một số vụ gửi SPAM lại nhằm mục đích bất chính hoặc cũng có những kẻ gửi SPAM chỉ để bày tỏ quan điểm chính trị hoặc tôn giáo. Hình thức gửi SPAM nguy hiểm nhất là hình thức gửi đi những thông điệp để lừa người dùng tiết lộ thông tin tài khoản ngân hàng trực tiếp, số thẻ tín dụng … - hay đây chính là một dang phổ biến của lừa đảo trực tuyến. Do không có một cách thức hiệu quả nào để lọc spam nhận vào trước khi nó được nhận bởi server tại ISP cục bộ, ISP phải trả chi phí về băng thông cho các gói tin mà họ nhận. Theo thống kê của phần lớn các ISP thì họ thường bị spam chiếm khoảng 25-30% băng thông. Spam làm tràn bộ đệm của người dùng với các mail quảng cáo, có khi làm họ không nhận được các mail khác. Qua đó ta thấy spam đã sử dụng một lượng lớn tài nguyên mà không cần sự cho phép hay có bất kỳ một hành động bồi thường thiệt hại nào, làm cho cộng đồng Internet phải tốn một chi phí đáng kể. Những chi phí liên quan khi spam sẽ được trả bởi người nhận chứ không phải là từ các spammer. Tài khoản của spammer sẽ bị hủy bỏ ngay khi ISP phát hiện ra nó dùng để gửi spam, vì thế mà hầu hết các spam đều được gửi từ những tài khoản thử miễn phí (Trial account) để không mất bất kỳ một chi phí nào. Do hầu hết các ISP đều có một chính sách giới hạn tự động nhằm tránh sự lạm dụng hệ thống của họ, các spammer sẽ chuyển gói tin sang các hệ thống ở các nước khác, chiếm thời gian xử lý và băng thông mà không cần hiểu rõ về các hệ thống đó. Theo báo cáo vào khoảng tháng 6 năm 2008 thì phần trăm Spam trong tổng số email trên toàn thế giới có xu hướng tăng lên khá rõ. Và tác hại do nó thì không thể đo hay tính được, nhưng theo thống kê của Internet Week thì "50 tỉ USD mỗi năm" là số tiền mà các công ty, tổ chức thương mại trên thế giới phải bỏ ra để đối phó với nạn thư rác đang hàng ngày tấn công vào hòm thư của nhân viên. Mỹ là quốc gia chịu nhiều thiệt hại nhất, chiếm 1/3 số tiền nói trên. Đó là tác hại chung về kinh tế, riêng cá nhân thì mỗi người cũng có ý kiến riêng của mình về tác hại của Spam. Vậy, biện pháp và cách hạn chế như thế nào để mỗi khi check mail, bạn không còn phải đối phó với đống thư Spam kia nữa? Bảo mật email và cách phòng chống spam 3.2 Các biện pháp phòng chống spam Gmail, hay còn gọi là Google Mail là một dịch vụ e-mail trên nền web và e-mail POP3 miễn phí do Google cung cấp. Bản beta được đưa vào hoạt động vào ngày 1 tháng 4 năm 2004, với hình thức chỉ dành cho thư mời và được mở rộng thành bản beta cho tất cả mọi người vào tháng 2 năm 2007. Gmail hỗ trợ POP3 và hơn 7GB không gian lưu trữ, một công cụ tìm kiếm và đàm thoại trực tuyến hay chat, và khả năng bảo mật tốt, cảnh báo virus. Gmail nổi tiếng với việc sử dụng công nghệ Ajax trong thiết kế. Gmail hỗ trợ nhiều trình duyệt (browser) và hỗ trợ đa ngôn ngữ (multilanguages), địa chỉ người gửi đến và người gửi đi tự động nhập lưu vào address book. Năm 2005, Gmail là sản phẩm đứng thứ hai sau Mozilla Firefox trong 100 sản phẩm tốt nhất được tạp chí PC World bình chọn. Còn đây là Biểu đồ lọc Spam mail của Gmail qua thời gian được thống kê: Như đã phân tích ở phần đầu, các spammer liên tục xả mail vào người dùng qua Internet, màu đỏ tăng liên tục theo thời gian cho thấy sự bành trướng của nạn spam mail này. Màu xanh dương là số email may mắn lọt qua được bộ lọc của Gmail vào Inbox trong tài khoản người dùng Gmail. Chúng ta có thể thấy, càng ngày số lượng % spam mail thoát qua bộ lọc càng giảm đi dù cho chúng có bành trướng lên mức cao như thế nào. Vậy Gmail đã làm như thế nào để đạt được những thành công đáng nể như vậy? Chúng ta cùng nhau nghiên cứu các công nghệ của Google để chống spam. Bảo mật email và cách phòng chống spam Nhìn trên Sơ đồ mô tả bộ lọc Gmail ta thấy: Email được gởi tới người dùng từ nhiều nguồn và được phân loại thành nhiều loại khác nhau: - Email hợp lệ: bao gồm các email bạn bè, công việc... khi gởi tới me@gmail.com, bước tiếp theo là qua bộ lọc Gmail Filter và được đi thẳng vào Gmail Inbox. - Email chứa file lớn, dạng julk mail có thể gây nghẽn đường truyền ISP khi nó đi qua bộ lọc của Gmail thì đi thẳng vào All Mail luôn chứ không nằm trong Inbox và cũng không trong Spam box bởi vì chúng không phải là Spam mail. - Mail lỗi, sai địa chỉ, lỗi đường truyền... tất nhiên nó bị cắt đứt ngay khi còn lang thang trên mạng. - Spam mail: Sau khi qua bộ lọc của Gmail thì nhanh chóng bị đưa vào Spam box ngay. Người dùng có thể check mail trong Gmail Inbox bằng trình duyệt Web (browser) hoặc các phần mềm check mail Client như Outlook, Windows Mail, Thunder Bird... Một khi mà bộ lọc chưa làm tốt công việc của mình thì Gmail có thêm chức năng người dùng tự báo cáo spam mail cho bộ lọc biết, tại đây qua quá trình tổng hợp và phân tích từ nhiều report tương tự khác về email phát tán spam thì những lần tới chúng sẽ bị loại ra khỏi Inbox và đẩy vào thẳng Spam box của Gmail. Nhìn mô tả trông thật là đơn giản và dễ hiểu, vấn đề không hề đơn giản như vậy, để tạo được bộ lọc thông minh, không chỉ Gmail mà tất cả các nhà cung cấp dịch vụ email khác như Yahoo, Live Mail, AOL Mail... đều phải áp dụng các công nghệ chống thư rác sau đây. Bảo mật email và cách phòng chống spam 3.2.1 DNS Blacklist Google sử dụng phương pháp DNS blacklist sẽ chặn các email đến từ các địa chỉ nằm trong danh sách DNS blacklist. Có hai loại danh sách DNS Blacklist thường được sử dụng, đó là: • Danh sách các miền, các domain name gửi spam đã biết. • Danh sách các máy chủ email cho phép hoặc bị lợi dụng thực hiện việc chuyển tiếp spam tới người dùng từ những email được gửi đi từ spammer. Khi một email được gửi đi, nó sẽ đi qua một số SMTP server trước khi chuyển tới địa chỉ người nhận. Địa chỉ IP của các SMTP server mà email đó đã chuyển qua được ghi tron phần header của email. Các chương trình chống spam sẽ kiểm tra tất cả các địa chỉ IP đã được tìm thấy trong phần header của email đó sau đó so sánh với cơ sở dữ liệu DNS Blacklist đã biết. Nếu địa chỉ IP tìm thấy trong phần này có trong cơ sở dữ liệu về các DNS Blacklist, nó sẽ bị coi là spam, còn nếu không, email đó sẽ được coi là một email hợp lệ. Bảo mật email và cách phòng chống spam 3.2.2 SURBL list Phương pháp mà Google sử dụng là: SURBL - phát hiện spam dựa vào nội dung của email. Chương trình chống spam sẽ phân tích nội dung của email xem bên trong nó có chứa các liên kết đã được liệt kê trong Spam URI Realtime Blocklists (SURBL) hay không. SURBL chứa danh sách các miền và địa chỉ của các spammer đã biết. Có nhiều danh sách SURBL khác nhau như sc.surbl.org, ws.surbl.org, ob.surbl.org, ab.surbl.org..., các danh sách này được cập nhật từ nhiều nguồn. Thông thường, người quản trị thường kết hợp các SURBL list bằng cách tham chiếu tới địa chỉ multi.surbl.org. Nếu một email sau khi kiểm tra nội dung có chứa các liên kết được chỉ ra trong SURBL list thì nó sẽ được đánh dấu là spam email, còn không nó sẽ được cho là một email thông thường và được chuyển qua các bộ lọc khác. Phương pháp này có ưu điểm phát hiện được các email giả mạo địa chỉ người gửi để đánh lừa các bộ lọc. Nhược điểm của nó là email phải được tải xuống trước khi tiến hành kiểm tra, do đó sẽ chiếm băng thông nguyên của máy tính để phân tích các nội dung email. 3.2.3 Chặn IP Phương pháp này sẽ chặn các email được gửi đến từ các địa chỉ IP biết trước. Khi một email đến, bộ lọc sẽ phân tích địa chỉ máy gửi và so sánh với danh sách địa chỉ bị chặn. Nếu email đó đến từ một máy có địa chỉ trong danh sách này thì nó sẽ bị coi là spam, ngược lại nó sẽ được coi là email hợp lệ. Bảo mật email và cách phòng chống spam 3.2.4 Kiểm tra địa chỉ IP Bằng cách kiểm tra địa chỉ người gửi và người nhận, phần lớn spam sẽ được phát hiện và chặn lại. Thực hiện kiểm tra địa chỉ người gửi trước khi email được tải xuống sẽ tiết kiệm được băng thông đường truyền cho toàn hệ thống. Kỹ thuật Sender Policy Framework (SPF, www.openspf.org) được sử dụng để kiểm tra địa chỉ người gửi email. Kỹ thuật SPF cho phép chủ sở hữu của một tên miền Internet sử dụng các DNS đặc biệt (gọi là bản ghi SPF) chỉ rõ các máy được dùng để gửi email từ miền của họ. Khi một email được gửi tới, bộ lọc SPF sẽ phân tích các thông tin trong trường “From” hoặc “Sender” để kiểm tra địa chỉ người gửi. Sau đó SPF sẽ đối chiếu địa chỉ đó với các thông tin đã được công bố trong bản ghi SPF của miền đó xem máy gửi email có được phép gửi email hay không. Nếu email đến từ một server không có trong bản ghi SPF mà miền đó đã công bố thì email đó bị coi là giả mạo. 3.2.5 Sử dụng bộ lọc Bayesian Bảo mật email và cách phòng chống spam Bộ lọc Bayesian hoạt động dựa trên định lý Bayes để tính toán xác suất xảy ra một sự kiện dựa vào những sự kiện xảy ra trước đó. Kỹ thuật tương tự như vậy được sử dụng để phân loại spam. Nếu một số phần văn bản xuất hiện thường xuyên trong các spam nhưng thường không xuất hiện trong các email thông thường, thì có thể kết luận rằng email đó là spam. Trước khi có thể lọc email bằng bộ lọc Bayesian, người dùng cần tạo ra cơ sở dữliệu từ khóa và dấu hiệu (như là ký hiệu $, địa chỉ IP và các miền...) sưu tầm từ các spam và các email không hợp lệ khác. Mỗi từ hoặc mỗi dấu hiệu sẽ được cho một giá trị xác suất xuất hiện, giá trị này dựa trên việc tính toán có bao nhiêu từ thường hay sử dụng trong spam, mà trong các email hợp lệ thường không sử dụng. Việc tính toán này được thực hiện bằng cách phân tích những email gửi đi của người dùng và phân tích các kiểu spam đã biết. Để bộ lọc Bayesian hoạt động chính xác và có hiệu quả cao, cần phải tạo ra cơ sở dữ liệu về các email thông thường và spam phù hợp với đặc thù kinh doanh của từng công ty. Cơ sở dữ liệu này được hình thành khi bộ lọc trải qua giai đoạn “huấn luyện”. Người quản trị phải cung cấp khoảng 1000 email thông thường và 1000 spam để bộ lọc phân tích tạo ra cơ sở dữ liệu cho riêng nó. 3.2.6 Sử dụng danh sách Black/white list Việc sử dụng các danh sách black list, white list giúp cho việc lọc spam hiệu quả hơn. Black list là cơ sở dữ liệu các địa chỉ email và các miền mà bạn không bao giờ muốn nhận các email từ đó. Các email gửi tới từ các địa chỉ này sẽ bị đánh dấu là spam. Bảo mật email và cách phòng chống spam White list là cơ sở dữ liệu các địa chỉ email và các miền mà bạn mong muốn nhận email từ đó. Nếu các email được gửi đến từ những địa chỉ nằm trong danh sách này thì chúng luôn được cho qua. Thông thường các bộ lọc có tính năng tự học, khi một email bị đánh dấu là spam thì địa chỉ người gửi sẽ được tự động đưa vào danh sách black list. Ngược lại, khi một email được gửi đi từ trong công ty thì địa chỉ người nhận sẽ được tựđộng đưa vào danh sách white list. 3.2.7 Sử dụng tính năng Challenge/Response Tính năng này sẽ yêu cầu người lần đầu gửi email xác nhận lại email đầu tiên mà họ đã gửi, sau khi xác nhận, địa chỉ email của người gửi được bổ sung vào danh sách White list và từ đó trở về sau các email được gửi từ địa chỉ đó được tự động cho qua các bộ lọc. Do spammer sử dụng các chương trình gửi email tự động và họ không thể xác nhận lại tất cả các email đã gửi đi, vì thế những email không được xác nhận sẽbị coi là spam. Phương pháp này có hạn chế là nó yêu cầu những người gửi mới phải xác nhận lại email đầu tiên mà họ gửi. Để khắc phục nhược điểm này, người quản trị chỉnên sử dụng phương pháp này đối với những email mà họ nghi ngờ là spam. Bảo mật email và cách phòng chống spam 3.2.8 Kiểm tra header Phương pháp này sẽ phân tích các trường trong phần header của email để đánh giá email đó là email thông thường hay là spam. Spam thường có một số đặc điểm như: - Để trống trường From: hoặc trường To: - Trường From: chứa địa chỉ email không tuân theo các chuẩn RFC. - Các URL trong phần header và phần thân của message có chứa địa chỉ IP được mã hóa dưới dạng hệ hex/oct hoặc có sự kết hợp theo dạng username/password Ví dụ các địa chỉ: www.website.com@spammer.com - Phần tiêu đề của email có thể chứa địa chỉ email người nhận để cá nhân hóa email đó. Lưu ý khi sử dụng tính năng này với các địa chỉ email dùng chung có dạng như sales@company.com. Ví dụ khi một khách hàng phản hồi bằng cách sử dụng tính năng auto-reply với tiêu đề “your email to sales” có thể bị đánh dấu là spam. - Gửi tới một số lượng rất lớn người nhận khác nhau. - Chỉ chứa những file ảnh mà không chứa các từ để đánh lừa các bộ lọc. - Sử dụng ngôn ngữ khác với ngôn ngữ mà người nhận đang sử dụng. Dựa vào những đặc điểm này của spam, các bộ lọc có thể lọc chặn. Bảo mật email và cách phòng chống spam CHƯƠNG IV CÁC GIẢI PHÁP BẢO MẬT EMAIL 4.1 Các cơ chế mã hóa email 4.1.1 Mã hóa và xác thực bằng PGP PGP_Xác thực: - User tạo thư - Dùng hàm băm SHA-1 lên nội dung thư - Dùng RSA mà hóa mã băm bằng khóa riêng của người gửi. - Gắn kết quả vào nội dung thư PGP_Mã hóa: - Người gửi tạo số ngẫu nhiên 128 bit - Mã hóa nội dung thư bằng thuật toán mã hóa (3DES, CAST_128 hoặc IDEA), dùng số ngẫu nhiên vừa sinh ra làm khóa - Mã hóa bằng kháo công khai của người nhận và gắn vào đầu thư PGP_Kết hợp mã hóa và xác thực: Bảo mật email và cách phòng chống spam 4.1.2 Mã hóa và xác thực bằng MIME Các chức năng của MIME: - Enveloped data: mã hóa thư - Signed data: xác thực thư, có chuyển mã - Clear-signed data: xác thực không chuyển mã - Signed and enveloped data: mã hóa và xác thực đồng thời MIME_Mã hóa nội dung thư: - Tạo khóa ngẫu nhiên tương ứng vói thuật toán mã đối xứng được chọn - Mã hóa bằng khóa công khai của người nhận (RSA). - Mã hóa nội dung thư với khóa ngẫu nhiên vừa tạo MIME_Xác thực: - Chọn một hàm băm tương ứng với khả năng của người nhận - Áp dụng hàm băm lên nội dung thư - Mã hóa hàm băm bằng khóa riêng (PR) của người gửi 4.2 Ứng dụng PGP 4.2.1 Cài đặt Bạn có thể lấy GnuPG từ Site chính thực của GnuPG ( từ bạn có thể chọn các Mirmor có vị trí địa lý ở gần bạn để Download GnuPG về. Phiên bản mà nhóm làm là phiên bản có giao diện dành cho window. Hiện nay là vesion gpg4win-1.1.3 Sau đó nhắp đôi vào gpg4win-1.1.3 Bảo mật email và cách phòng chống spam Ta chọn next để tiếp tục Ta chọn next, mặc định ta sẽ có hình sau: Bảo mật email và cách phòng chống spam Ta thấy bảng trên, chọn next ta được như hình sau: Bấm nút Browse.. để chọn ổ đĩa mà bạn muốn lưu, sau đó chọn next xuất hiện bảng sau: Bảo mật email và cách phòng chống spam Tiếp tục chọn next tiến trình install bắt đầu Chọn next Bảo mật email và cách phòng chống spam Chọn finish để kết thúc quá trình cài đặt. Máy tính của bạn sẽ yêu cầu restart . Sau khi cài đặt xong chúng ta có thể sử dụng chương trình này để mã hóa file. 4.2.2 Sử dụng khóa 4.2.2.1 Tạo khóa (Creating Keys) Đầu tiên bạn mở chương trình lên, bạn sẽ thấy có giao diên như sau: Bạn chọn key Bảo mật email và cách phòng chống spam Một cặp khoá mới sẽ được tạo (gồm Secret Key và Public Key). GnuPG sẽ hỏ bạn sử dụng thuật toán mã hoá nào. 2 thuật toán mã hoá được sử dụng rộng rãi là DSA và RSA. Tuy nhiên theo ý kiến của bản thân ta thì RSA được sử dụng rỗng rãi và có khả năng mã hoá dữ liệu ở mức độ cao hơn DSA. Lựa chọn kế tiếp của bạn sẽ là độ dài của Key (Key Lenght). Bạn cần lựa chọn giữa 2 tính năng sự bảo mật và thời gian. Nói một cách dễ hiểu nếu độ dài của Key lớn thì khả năng mã hoá thông điệp càng cao. Chính vì vậy thời gian mà PC của bạn dành để thực hiện công việc mã hoá và giải mã hoá sẽ lớn. Mặc định với GnuPG giá trị cực tiểu độ dài của key là 768 bits và giá trị cực đại là 2048 bits. Bảo mật email và cách phòng chống spam GnuPG sẽ lần lượt yêu cầu bạn vào các thông tin về bạn như: Họ và tên đầy đủ (Fullname), địa chỉ (Comment), địa chỉ mail (E-mail). Để làm cơ sở cho công việc tạo ra cặp khoá mới của GnuPG. Bạn có thể thay đổi các thông tin này sau. Cuối cùng bạn sẽ phải nhập vào một Password (có chấp nhận ký tự Space). Nó được sử dụng để điều khiển Secret Key của bạn. Một Passphrase tốt chứa đựng những yếu tố sau: Nó phải có độ dài hợp lý Chứa đựng những ký tự đặc biệt Đảm bảo an toàn không bị suy đoán một cách dễ dàng (không sử dụng các thông tin liên quan đến bạn như: tên, ngày sinh, địa chỉ, số nhà...) Nên nhớ rằng bạn không được phép quên Password đã nêu ở trên. Bởi nếu quên nó bạn sẽ không thể phục hồi lại nó cũng như điều kiểm soát Secret Key mà bạn đã tạo ra. Bảo mật email và cách phòng chống spam Sau cùng bạn dùng bàn phím nhập vào các ký tự ngẫu nhiên đủ yêu cầu số bit mà GnuPG cần để tạo ra một cặp khoá mới (để đảm bảo tính ngẫu nhiên và sự bảo mật cho cặp khoá mới). Bạn đợi trong giây lất, GnuPG đang phân tích, tính toán các thông tin mà bạn đưa vào để tạo ra cho bạn một cặp khoá mới. Quá trình này hoàn tất bạn sẽ có trong tay 2 Key: Public Key và Secret Key (Private Key). Có một điều bạn chú ý là nếu chọn thuật toán là DSA and ElGamal thì có 2 subkey và mọi chức năng của chương trình đều thực hiện được: Bảo mật email và cách phòng chống spam Nếu bạn chọn thuật toán là RSA và DSA thì chỉ có 1 Subkeys đựơc tạo ra và nếu thuật tóan là DSA thì không thể mã hóa được , còn RSA thì thực hiện đủ các chức năng : Bảo mật email và cách phòng chống spam Ta có thể thay đổi thời gian cho phép của key :Chọn key rồi vào menu Keys->Edit private key…->Change expiration Ta có thể thay đổi pass pharse của key :Chọn key rồi vào menu Keys->Edit private key…->Change passphrase : Chắc đến đây bạn sẽ đặt câu hỏi tại sao lại phải xuất Keys ? Hiểu một cách đơn giản khi xuất khoá bạn sẽ có khả năng trao đổi dữ liệu một cách an toàn với nhiều dùng khác trên Internet. Khi xuất Public Key bạn sẽ chia sẻ nó với bất cứ ai muốn trao đổi thông tin với bạn một cách an toàn. Bảo mật email và cách phòng chống spam 4.2.2.2 Nhập khoá (Import Keys) Khi bạn có được Public Key của một ai đó. Bạn cần phải Add nó vào Key Database của bạn để sau này sẽ sử dụng đến nó. Bạn sẽ dùng chính nó để giải mã hoá các dữ liệu đã được chính chủ nhân của nó mã hoá bằng Public Key mà bạn đang có ở các lần sau. 4.2.2.3 Huỷ bỏ khoá (Revoke A Keys) Bởi một vài lý do như: Secret Key bị mất, UID bị thay đổi, nó không còn đáp ứng được các nhu cầu của bạn nữa...hay đơn giản là bạn không muốn sử dụng Key đó nữa. Bạn muốn huỷ bỏ chúng. Để thực hiện điều này bạn cần một Secret Key khác để đảm bảo rằng chỉ có chủ sở hữu thực sự mới có quyền huỷ bỏ các Key đó. Lúc này! nếu như không biết Passphrase của Key đó thì mọi việc sẻ trở lên vô ích, thật bất lợi. Để khắc phục vấn đề này, GnuPG sẽ cấp cho bạn một sự cho phép huỷ bỏ Key "License Revoke" ngay khi bạn tạo một cặp khoá mới. Bạn lên cất giữ nó một cách cẩn thận...Bởi nếu bị lọt ra ngoài thì hậu quả của nó sẽ rất nghiêm trọng. Để thực hiện điều này bạn cần một Secret Key khác để đảm bảo rằng chỉ có chủ sở hữu thực sự mới có quyền huỷ bỏ các Key đó. Lúc này! nếu như không biết Passphrase của Key đó thì mọi việc sẻ trở lên vô ích, thật bất lợi. Để khắc phục vấn đề này, GnuPG sẽ cấp cho bạn một sự cho phép huỷ bỏ Key "License Revoke" ngay khi bạn tạo một cặp khoá mới. Bạn lên cất giữ nó một cách cẩn thận...Bởi nếu bị lọt ra ngoài thì hậu quả của nó sẽ rất nghiêm trọng. Bảo mật email và cách phòng chống spam Đây là một lệnh khá quan trọng trong quá trình sử dụng các Keys. Nó được sử dụng để thay đổi thông tin về thời hạn cuả Keys (Expiration Dates), thêm vào Fingerprint...cũng như chỉnh sửa các thông tin quan trọng khác. Trước khi bắt đầu quá trình chỉnh sửa, để đảm bảo an toàn GnuPG sẽ yêu cầu bạn vào thông tin về Passphrase. Bảo mật email và cách phòng chống spam 4.2.3 Mã hoá và giải mã hoá (Encrypt And Decrypt) Sau khi mọi công việc như cài đặt và cấu hình đã xong xuôi. Bây giờ chúng ta bắt đầu xem xét đến tính năng chính của GnuPG là mã hoá và giải mã hoá. Bạn cần biết rằng trong quá trình mã hoá và giải mã hoá không chỉ cần Public Key và Secret Key của bạn mà còn cần đến Public key của những người mà bạn muốn trao đổi dữ liệu với họ một cách an toàn. Khi mã hoá một đối tượng dữ liệu cho người khác thì bạn sẽ phải chọn chính Public Key của họ để mã hoá nó. Sau đó gửi cho họ, họ sẽ dùng chính Secret Key của mình để giải mã hoá dữ liệu mà bạn đã mã hoá bằng chính Public Key của họ. Chính vì vậy phương pháp mã hoá dữ liệu này tỏ ra rất an toàn. 4.2.3.1 Mã hoá (Encrypt) Trước khi muốn mã hoá dữ liệu và trao đổi với họ bạn phải có và đã bổ xung Public Key của họ vào Database Key của bạn. Nói một cách dễ hiểu ta đã dùng chính Public Key của họ để mã hoá dữ liệu rồi gửi lại cho họ. Ví dụ : Bước 1: Nhập file cần mã hóa .Chọn chức năng Encrypt . Bước 2: Chọn public key cua userVinh , Sign là User Vu . Bảo mật email và cách phòng chống spam Bước 3: Nhập vào public key của user Vu . Tạo ra file mã hóa data.doc.asc 4.2.3.2 Giải mã hoá (Decrypt) Quá trình giải mã hoá thì đơn giản hơn, sau khi nhận được dữ liệu đã mã hoá của ta gửi cho. Về phía người nhận nếu họ muốn giải mã hoá Thực chất của quá trình giải mã hoá dữ liệu là người nhận sẽ dùng chính Secret Key của họ để giải mã hoá dữ liệu mà ta đã mã hoá bằng chính Public Key của họ. Dĩ nhiên, khi họ muốn trao đổi dữ liệu mã hoá bằng GnuPG với ta thì họ cũng làm những việc tương tự như đã nêu ở trên đối với ta. Ví dụ : user Vinh send dữ liệu cho user Vu file data.doc.asc ( là file đã mã hóa) thì user Vu muốn lấy được dữ liệu thì cần phải giải mã lại .Các bước như sau : Bảo mật email và cách phòng chống spam Bước 1: chọn file cần giải mã .Chọn chức năng Decrypt Bước 2 : Cần nhập pass của user Vu để lấy được Secret Key Bảo mật email và cách phòng chống spam Bước 3: Tạo ra file ban đầu la data .doc (Nếu không đúng định dạng file thì chương trình sẽ báo lỗi) 4.2.4 Quá trình ký nhận và kiểm tra chữ ký (Sign And Checking Signatures) 4.2.4.1 Ký nhận: Bước 1: Vào chức năng file .Chọn file muốn ký nhận rồi chọn chức năng Sign Bảo mật email và cách phòng chống spam Bước 2: +Để ký nhận dữ liệu bằng Key của mình ta chọn chức năng :sign and compress. +Nếu như ta muốn có một kết quả rõ ràng hơn ta có thể sử chức năng : cleartext signature. +Khi các kết quả được hiển thị không rõ ràng .Nếu ta muốn tách riêng chữ ký của mình ra một file riêng biệt ? Tính năng này thường được sử dụng để mã hoá những file nhị phân (Binary). ta có thể sử dụng chức năng :sign in separate file. Sau ký xong ta có kết quả : Bảo mật email và cách phòng chống spam +Nếu chọn sign and compress : tạo ra file data.txt.pgp . +Nếu chọn cleartext signature: tạo ra file data.txt.asc . +Nếu chọn sign in separate file: tạo ra file data.txt.sig . 4.2.4.2 Xác nhận: +Trước tiên ta vào WinPT tức là quản lý khóa để chọn pass pharse của user nào cho public key Chọn Key->sign Rồi điền vào Passphrase: Bảo mật email và cách phòng chống spam +Sau đó Ta Vào chức năng file .Chọn file muốn ký nhận rồi chọn chức năng Verify Nếu như file có chữ ký hợp lệ thì sẽ hiển thị như vậy : THE END Bảo mật email và cách phòng chống spam